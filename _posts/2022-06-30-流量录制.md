---
title: ğŸ“½ï¸æµé‡å½•åˆ¶
author: Ancient One
date: 2022-06-30
category: Jekyll
layout: post
---

å¦‚æœä¸æƒ³å†™ä»£ç ï¼Œä¹Ÿä¸æƒ³`YAML` ï¼Œé‚£ä¹ˆç”¨æµé‡å½•åˆ¶å§ã€‚

`aomaker`æä¾›`aomaker record`æˆ–è€…`arec`æ¥å½•åˆ¶æµè§ˆå™¨ä¸Šçš„æµé‡ï¼Œå½•åˆ¶å®Œæˆåï¼Œä¼šè‡ªåŠ¨åœ¨`yamlcase`ç›®å½•ä¸‹ç”Ÿæˆä¸€ä»½`xxx.yaml`æ–‡ä»¶ï¼Œå…¶ä¸­è®°å½•äº†è¯·æ±‚è°ƒç”¨ä¿¡æ¯ï¼Œå› ä¸ºè®°å½•çš„æ˜¯åŸå§‹æµé‡ï¼Œå¦‚æœä½ æƒ³è®©caseå›ºåŒ–ï¼Œåˆ™éœ€è¦æŒ‰ç…§`aomaker`æä¾›çš„`YAMLè¯­æ³•`å»å°†å¿…è¦çš„å‚æ•°è¿›è¡Œå‚æ•°åŒ–æ”¹é€ ã€‚

# æµé‡å½•åˆ¶

1.æ‰“å¼€æµè§ˆå™¨ï¼ˆä»¥`Chrome`ä¸ºä¾‹ï¼‰ï¼Œä¿®æ”¹æµè§ˆå™¨ä»£ç†ï¼Œå°†ä»£ç†æ”¹ä¸º`aomaker`ä»£ç†çš„ç«¯å£åœ°å€ã€‚

æœ‰ä¸¤ç§æ–¹å¼ï¼š

- åœ¨æµè§ˆå™¨è®¾ç½®ä¸­ï¼Œä¿®æ”¹æµè§ˆå™¨ä»£ç†ä¸º127.0.0.0:8082ï¼ˆä¸æ¨èï¼‰
- å®‰è£…æµè§ˆå™¨æ’ä»¶**Proxy SwitchyOmega**ï¼Œåœ¨æ’ä»¶ä¸­é…ç½®`aomaker`ä»£ç†ï¼Œå¹¶å°†ä»£ç†åˆ‡æ¢ä¸º`aomaker`ã€‚

![](https://cdn.jsdelivr.net/gh/ae86sen/mypic2/am.png)

è¯¥æ’ä»¶å¯ä»¥éå¸¸è½»æ¾çš„ç®¡ç†ä»£ç†å¹¶åˆ‡æ¢å¤šä¸ªä»£ç†ï¼Œéå¸¸æ–¹ä¾¿å¥½ç”¨ï¼Œå¼ºçƒˆæ¨è~

2.**è¿›å…¥åˆ°å·¥ç¨‹æ ¹ç›®å½•ä¸‹**ï¼Œæ‰§è¡Œ`aomaker record`å‘½ä»¤

æ ¼å¼ï¼š

```powershell
aomaker record [-h] [-f [FILTER_STR]] [-p [PORT]] [--flow-detail [LEVEL]] [--save_response [SAVE_RESPONSE]] [--save_headers [SAVE_HEADERS]] [file_name]
```

`aomaker record`æœ‰ä¸€ä¸ªç®€å†™å‘½ä»¤ï¼Œ`arec`ï¼Œä¸¤è€…ç­‰æ•ˆã€‚

æ‰§è¡Œ`aomaker record xxx.yaml`åï¼Œ`aomaker`å°†å¼€å§‹å½•åˆ¶ï¼Œæ­¤æ—¶åªéœ€è¦åœ¨æµè§ˆå™¨ä¸­å»æ“ä½œéœ€è¦è½¬åŒ–æˆçš„è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„ä¸šåŠ¡åœºæ™¯å³å¯ã€‚

![](https://cdn.jsdelivr.net/gh/ae86sen/mypic2/rec.png)

å½•åˆ¶å®Œæˆåï¼Œåœ¨æ§åˆ¶å°æŒ‰`ctrl+c`å³å¯é€€å‡ºå½•åˆ¶ï¼Œè¾“å‡ºçš„æ–‡ä»¶å°†æ”¾åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„`yamlcase`ç›®å½•ä¸­ã€‚

å‚æ•°è¯´æ˜ï¼š

- **-f, --filter_str**

æŒ‡å®šè¿‡æ»¤å­—æ®µï¼Œå¦‚`-f "console.shanhe.com"`ï¼Œå³è¡¨ç¤ºä»£ç†åªæ•è·urlä¸­å«æœ‰`"console.shanhe.com"`çš„è¯·æ±‚ã€‚

ä¹Ÿå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªè¿‡æ»¤å­—æ®µï¼ˆè¿‡æ»¤è¡¨è¾¾å¼å‚è€ƒä¸‹é¢ï¼‰ï¼Œç”¨"|"åˆ†å‰²å³å¯ï¼Œå¤šä¸ªæ¡ä»¶ç›´æ¥æ˜¯"and"å…³ç³»ï¼Œå¦‚`-f "console.shanhe.com | ~hq method:/alarm"`ï¼Œè¡¨ç¤ºä»£ç†åªæ•è·urlä¸­å«æœ‰`"console.shanhe.com"`å’Œè¯·æ±‚å¤´ä¸­æœ‰`"method:/alarm"`çš„è¯·æ±‚ã€‚

é™„æ”¯æŒçš„è¿‡æ»¤è¡¨è¾¾å¼ï¼š

```python
The following operators are understood:

        ~q          Request
        ~s          Response

    Headers:

        Patterns are matched against "name: value" strings. Field names are
        all-lowercase.

        ~a          Asset content-type in response. Asset content types are:
                        text/javascript
                        application/x-javascript
                        application/javascript
                        text/css
                        image/*
                        application/x-shockwave-flash
        ~h rex      Header line in either request or response
        ~hq rex     Header in request
        ~hs rex     Header in response

        ~b rex      Expression in the body of either request or response
        ~bq rex     Expression in the body of request
        ~bs rex     Expression in the body of response
        ~t rex      Shortcut for content-type header.

        ~d rex      Request domain
        ~m rex      Method
        ~u rex      URL
        ~c CODE     Response code.
        rex         Equivalent to ~u rex
```

- **-p,--port**

æŒ‡å®š`aomaker`ä»£ç†ç«¯å£ï¼Œé»˜è®¤ä¸º8082ã€‚

- **--flow-detail**

æŒ‡å®šä»£ç†å½•åˆ¶æ—¶è®°å½•æ—¥å¿—ä¿¡æ¯çš„è¯¦ç»†ç¨‹åº¦ï¼Œä¸€å…±0~4äº”ä¸ªç­‰çº§ï¼Œè¯¦ç»†ç¨‹åº¦ä¾æ¬¡é€’å¢ï¼Œé»˜è®¤ä¸º0ã€‚

- **--save_response**

æŒ‡å®šå½•åˆ¶æµé‡æ—¶ï¼Œæ˜¯å¦ä¿å­˜å“åº”ç»“æœï¼Œ0ä¸ºä¿å­˜ï¼Œ1ä¸ºä¸ä¿å­˜ï¼Œé»˜è®¤ä¸º0ã€‚

- **--save_headers**

æŒ‡å®šå½•åˆ¶æµé‡æ—¶ï¼Œæ˜¯å¦ä¿å­˜è¯·æ±‚å¤´ï¼Œ0ä¸ºä¿å­˜ï¼Œ1ä¸ºä¸ä¿å­˜ï¼Œé»˜è®¤ä¸º1ã€‚

- **file_name**

è¯¥å‚æ•°ä¸º**å¿…å¡«**å‚æ•°ï¼ŒæŒ‡å®šå½•åˆ¶æµé‡çš„è¾“å‡ºæ–‡ä»¶ï¼ˆYAMLæ ¼å¼ï¼‰ï¼Œéœ€è¦æ³¨æ„æŒ‡å®šæ–‡ä»¶åæ˜¯éœ€è¦æ·»åŠ åç¼€".yaml"æˆ–".yml"ï¼Œæ–‡ä»¶å°†ä¿å­˜åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`yamlcase`ç›®å½•ä¸‹ã€‚

**haræ–‡ä»¶è§£æ**

å¦‚æœä¸ä½¿ç”¨æµé‡å½•åˆ¶çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨`F12`ï¼Œ`fiddler`ï¼Œ`Charles`ç­‰åœºæ™¯æŠ“åŒ…å·¥å…·å¯¼å‡ºçš„`.har`æ–‡ä»¶ï¼Œ`aomaker`æ”¯æŒå°†`har`æ–‡ä»¶è§£æä¸º`YAML`æ ¼å¼çš„åŠŸèƒ½ï¼Œä½¿ç”¨å‘½ä»¤`aomaker har2y`å³å¯ã€‚

**å‚æ•°è¯´æ˜ï¼š**

- **har_path**

æŒ‡å®š.haræ–‡ä»¶ä½ç½®

- **yaml_path**

æŒ‡å®šè½¬åŒ–çš„.yamlæ–‡ä»¶è¾“å‡ºä½ç½®

- **--filter_str**

haræ–‡ä»¶è½¬åŒ–ä¸ºyamlæ–‡ä»¶æ—¶ï¼Œæ‰€éœ€è¦ç­›é€‰çš„å­—æ®µ

- **--exclude_str**

haræ–‡ä»¶è½¬åŒ–ä¸ºyamlæ–‡ä»¶æ—¶ï¼Œæ‰€éœ€è¦æ’é™¤çš„å­—æ®µ

- **--save_response**

æŒ‡å®šharæ–‡ä»¶è½¬åŒ–ä¸ºyamlæ–‡ä»¶æ—¶ï¼Œæ˜¯å¦ä¿å­˜å“åº”ç»“æœï¼Œ0ä¸ºä¿å­˜ï¼Œ1ä¸ºä¸ä¿å­˜ï¼Œé»˜è®¤ä¸º0ã€‚

- **--save_headers**

æŒ‡å®šharæ–‡ä»¶è½¬åŒ–ä¸ºyamlæ–‡ä»¶æ—¶ï¼Œæ˜¯å¦ä¿å­˜è¯·æ±‚å¤´ï¼Œ0ä¸ºä¿å­˜ï¼Œ1ä¸ºä¸ä¿å­˜ï¼Œé»˜è®¤ä¸º1ã€‚



# ä¿®æ”¹YAMLæ–‡ä»¶

å½•åˆ¶çš„æµé‡å°†ä¿å­˜åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`yamlcase`ç›®å½•ä¸‹ã€‚

å…·ä½“ä¿®æ”¹æ–¹æ³•å‚è€ƒä¸Šä¸€ç« ã€‚

